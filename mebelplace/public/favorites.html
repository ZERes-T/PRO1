<!doctype html><html lang="ru"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>–ò–∑–±—Ä–∞–Ω–Ω—ã–µ ‚Äî Zodak</title>
<link rel="stylesheet" href="/common.css"><script src="/domain-notice.js" defer></script>
<style>
  .thumb{width:64px;height:64px;border-radius:12px;background:#f7f7fb;border:1px solid var(--line);display:grid;place-items:center;font-size:20px}
  .skeleton{height:64px;border-radius:14px;border:1px solid var(--line);
    background:linear-gradient(90deg,#eef1f7,#f6f7fb 20%,#eef1f7 40%);background-size:200% 100%;animation:sh 1.1s infinite;margin:8px 0}
  @keyframes sh{0%{background-position:200% 0}100%{background-position:-200% 0}}
  .star{min-width:46px}
</style>
</head><body>
<header>
  <div class="title">–ò–∑–±—Ä–∞–Ω–Ω—ã–µ</div>
  <div style="flex:1"></div>
  <button id="btnRefresh" class="btn">–û–±–Ω–æ–≤–∏—Ç—å</button>
</header>

<main>
  <div class="card">
    <div id="list" class="list">
      <div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div>
    </div>
    <div id="empty" class="card" style="display:none;text-align:center">
      –ü–æ–∫–∞ –ø—É—Å—Ç–æ. –û—Ç–∫—Ä–æ–π –ª–µ–Ω—Ç—É –∏ —Ç–∞–ø–Ω–∏ ‚òÖ –Ω–∞ —Ä–æ–ª–∏–∫–µ.
      <div style="margin-top:8px"><a class="btn btn-primary" href="/">–í –ª–µ–Ω—Ç—É</a></div>
    </div>
    <div id="fallback" class="card" style="display:none;text-align:center">
      –ù–∞ –±—ç–∫–µ –µ—â—ë –Ω–µ—Ç —Å–ø–∏—Å–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ. –ü–æ–∫–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å/—É–±–∏—Ä–∞—Ç—å –∏–∑ –ª–µ–Ω—Ç—ã.
      <div style="margin-top:8px"><a class="btn" href="/">–û—Ç–∫—Ä—ã—Ç—å –ª–µ–Ω—Ç—É</a></div>
    </div>
  </div>
</main>

<nav class="bottom">
  <a href="/"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M8 5h8a3 3 0 0 1 3 3v8H5V8a3 3 0 0 1 3-3zm9 12v1a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2v-1zM9 8v6l5-3z"/></svg>–í–∏–¥–µ–æ</a>
  <a href="/requests.html"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M7 3h10a2 2 0 0 1 2 2v14l-7-3l-7 3V5a2 2 0 0 1 2-2z"/></svg>–ó–∞—è–≤–∫–∏</a>
  <a href="/favorites.html" class="active"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="m12 17.27 6.18 3.73-1.64-7.03L21 9.24l-7.19-.61L12 2 10.19 8.63 3 9.24l4.46 4.73L5.82 21z"/></svg>–ò–∑–±—Ä–∞–Ω–Ω—ã–µ</a>
  <a href="/profile.html"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zm0 2c-5 0-9 2.5-9 5.5A1.5 1.5 0 0 0 4.5 21h15A1.5 1.5 0 0 0 21 19.5C21 16.5 17 14 12 14z"/></svg>–ü—Ä–æ—Ñ–∏–ª—å</a>
</nav>

<script>
(()=>{const $=s=>document.querySelector(s);
const esc=s=>String(s??'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
function tok(){return localStorage.getItem('token')||''} if(!tok()){location.replace('/login.html?next=/favorites.html')}
function auth(){return {'Authorization':'Bearer '+tok(),'Content-Type':'application/json'}}

function cell(v){
  const el=document.createElement('div'); el.className='cell';
  const title = v.title || ('–í–∏–¥–µ–æ #'+(v.id??''));
  el.innerHTML=`<div class="row" style="min-width:0">
      <div class="thumb">üé¨</div>
      <div style="min-width:0">
        <b style="display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${esc(title)}</b>
        <div class="muted" style="font-size:12px">id: ${esc(v.id??'‚Äî')}</div>
      </div>
    </div>
    <button class="btn star">‚òÖ</button>`;
  el.querySelector('.star').onclick=()=>unfav(v.id, el);
  el.onclick=(e)=>{ if(e.target.classList.contains('star')) return; location.href='/?v='+encodeURIComponent(v.id||'') };
  return el;
}

async function listFavs(){
  $('#fallback').style.display='none'; $('#empty').style.display='none';
  $('#list').innerHTML='<div class="skeleton"></div><div class="skeleton"></div>';

  // –ø—Ä–æ–±—É–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
  try{
    const r = await fetch('/api/favorites',{headers:auth()});
    if (r.ok){
      const js = await r.json().catch(()=>({})); const arr=(js.items||js)||[];
      if(!arr.length){ $('#list').innerHTML=''; $('#empty').style.display='block'; return }
      $('#list').innerHTML=''; arr.forEach(v=>$('#list').appendChild(cell(v)));
      return;
    }
  }catch{}

  // –Ω–µ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —Ñ–æ–ª–ª–±—ç–∫
  $('#list').innerHTML='';
  $('#fallback').style.display='block';
}

async function unfav(id, row){
  try{
    const r = await fetch('/api/favorites/toggle',{method:'POST',headers:auth(),body:JSON.stringify({video_id:Number(id||0)})});
    if (!r.ok) throw 0;
    row.remove();
    if (!$('#list').children.length) $('#empty').style.display='block';
  }catch{ alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ') }
}

document.addEventListener('DOMContentLoaded',()=>{
  $('#btnRefresh').onclick=listFavs;
  listFavs();
});
})();
</script>
</body></html>

